<div class="container mt-3">
  <div class="row justify-content-center">
    <div class="col-12">
      <h2 class="text-center mb-3">Bookings</h2>
      <% if policy(Booking).index? %>
        <%= week_calendar events: @bookings do |date, bookings| %>
          <% (8..19).each do |hour| %>
            <% (0..1).each do |m| %>
              <div>
                <% time = DateTime.parse([date, "#{hour}:#{m * 30}"].join(' ')) %>
                <% time_to_s = time.strftime("%H:%M") %>
                <%= link_to time_to_s, new_booking_path(date: date, time: time_to_s) %>
                <% bookings.select{ |b| time >= b.start_time && time < b.end_time }.each do |booking| %>
                  <%= link_to booking_path(booking) do  %>
                    <%= booking.patient.short_name %>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
      <br>
      <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="pills-upcoming-tab" data-toggle="pill" href="#pills-upcoming" role="tab" aria-controls="pills-upcoming" aria-selected="true">Upcoming</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="pills-past-tab" data-toggle="pill" href="#pills-past" role="tab" aria-controls="pills-past" aria-selected="false">Past</a>
        </li>
      </ul>
      <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-upcoming" role="tabpanel" aria-labelledby="pills-upcoming-tab">
        <% @bookings.each do |booking| %>
          <% if booking.start_time > Time.now %>
            <%= link_to booking_path(booking), class: "list-group-item list-group-item-action" do  %>
              <% if policy(Booking).index? %>
                <% "#{booking.start_time.strftime("%a, %e %b %Y")} -
                Booking #{booking.id} - Patient: #{booking.patient.name}" %>
              <% else %>
                <% "#{booking.start_time.strftime("%a, %e %b %Y")} -
                Booking #{booking.id} - Doctor: #{booking.doctor.name}" %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        </div>
        <div class="tab-pane fade" id="pills-past" role="tabpanel" aria-labelledby="pills-past-tab">
        <% @bookings.each do |booking| %>
          <% if booking.start_time < Time.now %>
            <%= link_to booking_path(booking), class: "list-group-item list-group-item-action" do  %>
              <% if policy(Booking).index? %>
                <% "#{booking.start_time.strftime("%a, %e %b %Y")} -
                Booking #{booking.id} - Patient: #{booking.patient.name}" %>
              <% else %>
                <% "#{booking.start_time.strftime("%a, %e %b %Y")} -
                Booking #{booking.id} - Doctor: #{booking.doctor.name}" %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
